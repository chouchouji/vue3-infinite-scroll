(function(n,h){typeof exports=="object"&&typeof module<"u"?module.exports=h(require("vue")):typeof define=="function"&&define.amd?define(["vue"],h):(n=typeof globalThis<"u"?globalThis:n||self,n["vue3-infinite-scroll"]=h(n.Vue))})(this,function(n){"use strict";var St=Object.defineProperty;var gt=(n,h,m)=>h in n?St(n,h,{enumerable:!0,configurable:!0,writable:!0,value:m}):n[h]=m;var I=(n,h,m)=>(gt(n,typeof h!="symbol"?h+"":h,m),m);const h="auto",m="start",p="center",$="end",w="vertical",O="horizontal",V={[w]:"top",[O]:"left"},B={[w]:"height",[O]:"width"},D={width:{type:[Number,String],required:!0},height:{type:[Number,String],required:!0},data:{type:Array,required:!0,default:[]},direction:{type:String,default:w},itemSize:[Number,Array,Function],scrollToIndex:{type:Number,default:0},scrollOffset:{type:Number,default:0},scrollToAlignment:{type:String,default:h},overscanCount:{type:Number,default:4},estimatedSize:Number},P={position:"absolute",left:0,width:"100%",height:"100%"},G={position:"relative",overflow:"hidden",width:"100%",minHeight:"100%"},q={overflow:"auto",willChange:"transform",WebkitOverflowScrolling:"touch"},u=t=>typeof t=="string",C=t=>typeof t=="number",U=t=>typeof t=="boolean",H=t=>t===window,Y=()=>typeof window<"u",Z=t=>t==null?0:u(t)?(t=parseFloat(t),t=Number.isNaN(t)?0:t,t):U(t)?Number(t):t,j=t=>window.getComputedStyle(t),J=t=>{if(H(t)){const e=t.innerWidth,i=t.innerHeight,s={x:0,y:0,top:0,left:0,right:e,bottom:i,width:e,height:i};return{...s,toJSON:()=>s}}return t.getBoundingClientRect()};function K(){const{width:t,height:e}=J(window);return{vw:t,vh:e,vMin:Math.min(t,e),vMax:Math.max(t,e)}}const b=t=>u(t)&&t.endsWith("rem"),Q=t=>u(t)&&t.endsWith("em")&&!t.endsWith("rem"),X=t=>u(t)&&t.endsWith("px")||C(t),v=t=>u(t)&&t.endsWith("%"),L=t=>u(t)&&t.endsWith("vw"),E=t=>u(t)&&t.endsWith("vh"),R=t=>u(t)&&t.endsWith("vmin"),F=t=>u(t)&&t.endsWith("vmax"),tt=t=>u(t)&&t.startsWith("calc("),et=t=>u(t)&&t.startsWith("var("),it=t=>{if(C(t))return t;if(X(t))return+t.replace("px","");if(!Y())return 0;const{vw:e,vh:i,vMin:s,vMax:a}=K();if(L(t))return+t.replace("vw","")*e/100;if(E(t))return+t.replace("vh","")*i/100;if(R(t))return+t.replace("vmin","")*s/100;if(F(t))return+t.replace("vmax","")*a/100;if(b(t)){const o=+t.replace("rem",""),l=j(document.documentElement).fontSize;return o*parseFloat(l)}return u(t)?Z(t):0},z=t=>{if(t!=null)return v(t)||L(t)||E(t)||Q(t)||b(t)||tt(t)||et(t)||R(t)||F(t)?t:`${it(t)}px`};class nt{constructor({itemCount:e,itemSizeGetter:i,estimatedItemSize:s}){I(this,"itemSizeGetter");I(this,"itemCount");I(this,"estimatedItemSize");I(this,"lastMeasuredIndex");I(this,"itemSizeAndPositionData");this.itemSizeGetter=i,this.itemCount=e,this.estimatedItemSize=s,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}updateConfig({itemCount:e,estimatedItemSize:i}){this.itemCount=e,this.estimatedItemSize=i}getLastMeasuredIndex(){return this.lastMeasuredIndex}destroy(){for(const e in this.itemSizeAndPositionData)delete this.itemSizeAndPositionData[e]}getSizeAndPositionForIndex(e){if(e<0||e>=this.itemCount)throw Error(`Requested index ${e} is outside of range 0..${this.itemCount}`);if(e>this.lastMeasuredIndex){const i=this.getSizeAndPositionOfLastMeasuredItem();let s=i.offset+i.size;for(let a=this.lastMeasuredIndex+1;a<=e;a++){const o=this.itemSizeGetter(a);if(o==null||isNaN(o))throw Error(`Invalid size returned for index ${a} of value ${o}`);this.itemSizeAndPositionData[a]={offset:s,size:o},s+=o}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]}getSizeAndPositionOfLastMeasuredItem(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}}getTotalSize(){const e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize}getUpdatedOffsetForIndex({align:e=m,containerSize:i,currentOffset:s,targetIndex:a}){if(i<=0)return 0;const o=this.getSizeAndPositionForIndex(a),l=o.offset,c=l-i+o.size;let f;switch(e){case $:f=c;break;case p:f=l-(i-o.size)/2;break;case m:f=l;break;default:f=Math.max(c,Math.min(l,s))}const M=this.getTotalSize();return Math.max(0,Math.min(M-i,f))}getVisibleRange({containerSize:e,offset:i,overscanCount:s}){if(this.getTotalSize()===0)return{};const o=i+e;let l=this.findNearestItem(i);if(typeof l>"u")throw Error(`Invalid offset ${i} specified`);const c=this.getSizeAndPositionForIndex(l);i=c.offset+c.size;let f=l;for(;i<o&&f<this.itemCount-1;)f++,i+=this.getSizeAndPositionForIndex(f).size;return s&&(l=Math.max(0,l-s),f=Math.min(f+s,this.itemCount-1)),{start:l,stop:f}}resetItem(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)}findNearestItem(e){if(isNaN(e))throw Error(`Invalid offset ${e} specified`);e=Math.max(0,e);const i=this.getSizeAndPositionOfLastMeasuredItem(),s=Math.max(0,this.lastMeasuredIndex);return i.offset>=e?this.binarySearch({high:s,low:0,offset:e}):this.exponentialSearch({index:s,offset:e})}binarySearch({low:e,high:i,offset:s}){let a=0,o=0;for(;e<=i;){if(a=e+Math.floor((i-e)/2),o=this.getSizeAndPositionForIndex(a).offset,o===s)return a;o<s?e=a+1:o>s&&(i=a-1)}return e>0?e-1:0}exponentialSearch({index:e,offset:i}){let s=1;for(;e<this.itemCount&&this.getSizeAndPositionForIndex(e).offset<i;)e+=s,s*=2;return this.binarySearch({high:Math.min(e,this.itemCount-1),low:Math.floor(e/2),offset:i})}}const st=n.defineComponent({name:"InfiniteList",props:D,setup(t){let e={},i,s=0,a=0;const o=n.ref(0),l=n.ref(8),c=n.ref(null),f=n.ref(),M=n.ref(),W=n.computed(()=>t.data?t.data.length:0),N=n.computed(()=>t.estimatedSize||50),at=n.computed(()=>t.data?t.data.slice(o.value,Math.min(t.data.length,l.value+1)):[]),dt=n.computed(()=>t.direction==="horizontal"?"scrollLeft":"scrollTop"),lt=()=>({...q,width:z(t.width),height:z(t.height)}),_=()=>{const r={...G},d=z(i.getTotalSize());return t.direction==="horizontal"?(r.width=d,r):(r.height=d,r)},ct=r=>{const d=r+o.value,g=e[d];if(g)return g;if(!i)return P;const{size:y,offset:S}=i.getSizeAndPositionForIndex(d);return e[d]={...P,[B[t.direction]]:z(y),[V[t.direction]]:z(S)}},ft=()=>{ht(),c.value.addEventListener("scroll",k),s=t.scrollOffset||t.scrollToIndex!=null&&x(t.scrollToIndex,t.scrollToAlignment)||0,setTimeout(()=>{t.scrollOffset!=null?T(t.scrollOffset):t.scrollToIndex!=null&&T(x(t.scrollToIndex,t.scrollToAlignment))},0),M.value=lt(),f.value=_()},ht=()=>(i||(i=new nt({itemCount:W.value,estimatedItemSize:N.value,itemSizeGetter:r=>ut(r)})),i),k=r=>{const d=t.direction==="vertical"?c.value.scrollTop:c.value.scrollLeft;d<0||s===d||r.target!==c.value||(s=d,A())},A=()=>{const{width:r,height:d,direction:g,overscanCount:y}=t,S=i.getVisibleRange({containerSize:g==="horizontal"?r:d,offset:s||0,overscanCount:y});S.start!=null&&S.stop!=null&&(o.value=S.start,l.value=S.stop),f.value=_(),s!==a&&T(s)},T=r=>{c.value&&(c.value[dt.value]=r,a=r)},ut=r=>{const d=t.itemSize;return typeof d=="function"?d(r):Array.isArray(d)?d[r]:d||N.value},x=(r,d)=>{(r<0||r>=W.value)&&(r=0);const{width:g,height:y,direction:S}=t;return i.getUpdatedOffsetForIndex({align:d,containerSize:S==="horizontal"?g:y,currentOffset:s||0,targetIndex:r})},mt=()=>{for(let r in e)delete e[r]};return n.onMounted(()=>{setTimeout(ft,0)}),n.onBeforeUnmount(()=>{mt(),i.destroy(),c.value.removeEventListener("scroll",k)}),n.watch(()=>t.data,r=>{i.updateConfig({itemCount:(r==null?void 0:r.length)||0,estimatedItemSize:N.value}),s=0,a=0,e={},i.resetItem(0)}),n.watch(()=>t.scrollOffset,r=>{s=r,A()}),n.watch(()=>t.scrollToIndex,r=>{s=x(r,t.scrollToAlignment),A()}),n.watch(()=>t.scrollToAlignment,r=>{s=x(t.scrollToIndex,r),A()}),{start:o,visibleData:at,wrapStyle:M,innerStyle:f,rootNode:c,getItemStyle:ct}}}),rt=(t,e)=>{const i=t.__vccOpts||t;for(const[s,a]of e)i[s]=a;return i};function ot(t,e,i,s,a,o){return n.openBlock(),n.createElementBlock("div",{ref:"rootNode",style:n.normalizeStyle(t.wrapStyle)},[n.createElementVNode("div",{style:n.normalizeStyle(t.innerStyle)},[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(t.visibleData,(l,c)=>(n.openBlock(),n.createElementBlock("div",{key:c+t.start,style:n.normalizeStyle(t.getItemStyle(c))},[n.renderSlot(t.$slots,"default",{item:l,index:c+t.start})],4))),128))],4)],4)}return rt(st,[["render",ot]])});
